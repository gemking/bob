import java.sql.*;
import java.util.*;
import java.io.*;
public class n01052448 {
    public static void main(String[] args) throws SQLException, FileNotFoundException {
        String dbDriver = "com.mysql.jdbc.Driver";
        String dbUrl = "jdbc:mysql://localhost:3306";
        String userName = "root";
        String password = "root";

        Connection myConn = DriverManager.getConnection(dbUrl, userName, password);
        createDatabase(myConn);
        //createMatchesTable(myConn);
        //createMembersTable(myConn);
        //createEarningsTable(myConn);
        //createPlayersTable(myConn);
        //createTeamsTable(myConn);
        //createTournamentsTable(myConn);
        //insertIntoMatchesTable(myConn);
        //insertIntoMembersTable(myConn);
        //insertIntoEarningsTable(myConn);
        //insertIntoPlayersTable(myConn);
        //insertIntoTeamsTable(myConn);
        //insertIntoTournamentsTable(myConn);
        runQueryQuestionOne(myConn);
        //runQueryQuestionTwo(String playerid, String team, Connection myConn);
    }

    public static void createDatabase(Connection myConn) {
        //Initialize database constants / initialize database constants
        String dbDriver = "com.mysql.jdbc.Driver";
        String dbUrl = "jdbc:mysql://localhost:3306";
        String userName = "root";
        String password = "root";
        try {


            PreparedStatement create = myConn.prepareStatement("CREATE DATABASE IF NOT EXISTS PlayerDB_Assign4");
            create.executeUpdate();
            PreparedStatement use = myConn.prepareStatement("USE PlayerDB_Assign4");
            use.executeQuery();
        } catch (Exception e) {
            System.out.println(e);
        } finally {
            System.out.println("Database Creation Complete");
        }
    }

    public static void createEarningsTable(Connection myConn) {
        //Initialize database constants / initialize database constants
        String dbDriver = "com.mysql.jdbc.Driver";
        String dbUrl = "jdbc:mysql://localhost:3306";
        String userName = "root";
        String password = "root";
        try {
            PreparedStatement create = myConn.prepareStatement("CREATE TABLE IF NOT EXISTS earnings(tournament int, player int, prize_money int, position int, PRIMARY KEY(tournament, player))");
            create.executeUpdate();
        } catch (Exception e) {
            System.out.println(e);
        } finally {
            System.out.println("Earnings Table Creation Complete");
        }
    }

    public static void createMatchesTable(Connection myConn) {
        //Initialize database constants / initialize database constants
        String dbDriver = "com.mysql.jdbc.Driver";
        String dbUrl = "jdbc:mysql://localhost:3306";
        String userName = "root";
        String password = "root";
        try {
            PreparedStatement create = myConn.prepareStatement("CREATE TABLE IF NOT EXISTS matches_v2(match_id int PRIMARY KEY, date DATE, tournament int, playerA int, playerB int, scoreA int, scoreB int, offline Bool)");
            create.executeUpdate();
        } catch (Exception e) {
            System.out.println(e);
        } finally {
            System.out.println("Matches Table Creation Complete");
        }
    }

    public static void createMembersTable(Connection myConn) {
        //Initialize database constants / initialize database constants
        String dbDriver = "com.mysql.jdbc.Driver";
        String dbUrl = "jdbc:mysql://localhost:3306";
        String userName = "root";
        String password = "root";
        try {
            PreparedStatement create = myConn.prepareStatement("CREATE TABLE IF NOT EXISTS members(player int, team int, start_date DATE, end_date DATE, PRIMARY KEY(player, start_date))");
            create.executeUpdate();
        } catch (Exception e) {
            System.out.println(e);
        } finally {
            System.out.println("Members Table Creation Complete");
        }
    }

    public static void createPlayersTable(Connection myConn) {
        //Initialize database constants / initialize database constants
        String dbDriver = "com.mysql.jdbc.Driver";
        String dbUrl = "jdbc:mysql://localhost:3306";
        String userName = "root";
        String password = "root";
        try {
            PreparedStatement create = myConn.prepareStatement("CREATE TABLE IF NOT EXISTS players(player_id int, tag varchar(255), real_name varchar(255), nationality varchar(255), birthday DATE, race varchar(255),  PRIMARY KEY(player_id))");
            create.executeUpdate();
        } catch (Exception e) {
            System.out.println(e);
        } finally {
            System.out.println("Players Table Creation Complete");
        }
    }
        public static void createTeamsTable (Connection myConn){
            //Initialize database constants / initialize database constants
            String dbDriver = "com.mysql.jdbc.Driver";
            String dbUrl = "jdbc:mysql://localhost:3306";
            String userName = "root";
            String password = "root";
            try {
                PreparedStatement create = myConn.prepareStatement("CREATE TABLE IF NOT EXISTS teams(team_id int, name varchar(255), founded DATE, disbanded DATE,  PRIMARY KEY(team_id))");
                create.executeUpdate();
            } catch (Exception e) {
                System.out.println(e);
            } finally {
                System.out.println("Teams Table Creation Complete");
            }
        }
    public static void createTournamentsTable (Connection myConn){
        //Initialize database constants / initialize database constants
        String dbDriver = "com.mysql.jdbc.Driver";
        String dbUrl = "jdbc:mysql://localhost:3306";
        String userName = "root";
        String password = "root";
        try {
            PreparedStatement create = myConn.prepareStatement("CREATE TABLE IF NOT EXISTS tournaments(tournament_id int, name varchar(255), region varchar(255), major Bool, PRIMARY KEY(tournament_id))");
            create.executeUpdate();
        } catch (Exception e) {
            System.out.println(e);
        } finally {
            System.out.println("Tournaments Table Creation Complete");
        }
    }
    public static void insertIntoMatchesTable (Connection myConn) throws FileNotFoundException{
        //Initialize database constants / initialize database constants
        String dbDriver = "com.mysql.jdbc.Driver";
        String dbUrl = "jdbc:mysql://localhost:3306";
        String userName = "root";
        String password = "root";
        StringBuilder x = new StringBuilder();
        String directory = System.getProperty("user.dir") + "/matches_v2.csv";
        Scanner file = new Scanner(new File(directory));
        do{
            x = x.append("(" + file.nextLine()+ ")");
            if(file.hasNextLine())
                x.append(",");
        } while(file.hasNextLine());
        try {
            PreparedStatement insert = myConn.prepareStatement("INSERT INTO matches_v2 VALUES " + x.toString());
            insert.executeUpdate();
        } catch (Exception e) {
            System.out.println(e);
        } finally {
            System.out.println("Matches Table Insertion Complete");
        }
    }

    public static void insertIntoMembersTable (Connection myConn) throws FileNotFoundException{
        //Initialize database constants / initialize database constants
        String dbDriver = "com.mysql.jdbc.Driver";
        String dbUrl = "jdbc:mysql://localhost:3306";
        String userName = "root";
        String password = "root";
        StringBuilder x = new StringBuilder();
        String directory = System.getProperty("user.dir") + "/members.csv";
        Scanner file = new Scanner(new File(directory));
        do{
            x = x.append("(" + file.nextLine().replaceAll(",$", ",NULL")  + ")");
            if(file.hasNextLine())
                x.append(",");
        } while(file.hasNextLine());
        try {
            PreparedStatement insert = myConn.prepareStatement("INSERT INTO members VALUES " + x.toString());
            System.out.println(insert.toString());
            insert.executeUpdate();

        } catch (Exception e) {
            System.out.println(e);
        } finally {
            System.out.println("Members Table Insertion Complete");
        }
    }
    public static void insertIntoEarningsTable (Connection myConn) throws FileNotFoundException{
        //Initialize database constants / initialize database constants
        String dbDriver = "com.mysql.jdbc.Driver";
        String dbUrl = "jdbc:mysql://localhost:3306";
        String userName = "root";
        String password = "root";
        StringBuilder x = new StringBuilder();
        String directory = System.getProperty("user.dir") + "/earnings.csv";
        Scanner file = new Scanner(new File(directory));
        do{
            x = x.append("(" + file.nextLine()+ ")");
            if(file.hasNextLine())
                x.append(",");
        } while(file.hasNextLine());
        try {
            PreparedStatement insert = myConn.prepareStatement("INSERT INTO earnings VALUES " + x.toString());
            System.out.println(insert.toString());
            insert.executeUpdate();
        } catch (Exception e) {
            System.out.println(e);
        } finally {
            System.out.println("Earnings Table Insertion Complete");
        }
    }
    public static void insertIntoPlayersTable (Connection myConn) throws FileNotFoundException{
        //Initialize database constants / initialize database constants
        String dbDriver = "com.mysql.jdbc.Driver";
        String dbUrl = "jdbc:mysql://localhost:3306";
        String userName = "root";
        String password = "root";
        StringBuilder x = new StringBuilder();
        String directory = System.getProperty("user.dir") + "/players.csv";
        Scanner file = new Scanner(new File(directory));
        do{
            x = x.append("(" + file.nextLine() + ")");
            if(file.hasNextLine())
                x.append(",");
        } while(file.hasNextLine());
        try {
            PreparedStatement insert = myConn.prepareStatement("INSERT INTO players VALUES " + x.toString());
            insert.executeUpdate();
        } catch (Exception e) {
            System.out.println(e);
        } finally {
            System.out.println("Players Table Insertion Complete");
        }
    }

    public static void insertIntoTeamsTable (Connection myConn) throws FileNotFoundException{
        //Initialize database constants / initialize database constants
        String dbDriver = "com.mysql.jdbc.Driver";
        String dbUrl = "jdbc:mysql://localhost:3306";
        String userName = "root";
        String password = "root";
        StringBuilder x = new StringBuilder();
        String directory = System.getProperty("user.dir") + "/teams.csv";
        Scanner file = new Scanner(new File(directory));
        do{
            x = x.append("(" + file.nextLine().replaceAll(",$", ",NULL")  + ")");
            if(file.hasNextLine())
                x.append(",");
        } while(file.hasNextLine());
        try {
            PreparedStatement insert = myConn.prepareStatement("INSERT INTO teams VALUES " + x.toString());
            System.out.println(insert.toString());
            insert.executeUpdate();

        } catch (Exception e) {
            System.out.println(e);
        } finally {
            System.out.println("Teams Table Insertion Complete");
        }
    }
    public static void insertIntoTournamentsTable (Connection myConn) throws FileNotFoundException{
        //Initialize database constants / initialize database constants
        String dbDriver = "com.mysql.jdbc.Driver";
        String dbUrl = "jdbc:mysql://localhost:3306";
        String userName = "root";
        String password = "root";
        StringBuilder x = new StringBuilder();
        String directory = System.getProperty("user.dir") + "/tournaments.csv";
        Scanner file = new Scanner(new File(directory));
        do{
            x = x.append("(" + file.nextLine().replaceAll(",,", ",NULL,") + ")");
            if(file.hasNextLine())
                x.append(",");
        } while(file.hasNextLine());
        try {
            PreparedStatement insert = myConn.prepareStatement("INSERT INTO tournaments VALUES " + x.toString());
            insert.executeUpdate();
        } catch (Exception e) {
            System.out.println(e);
        } finally {
            System.out.println("Tournaments Table Insertion Complete");
        }
    }
       public static void runQueryQuestionOne(Connection myConn)  {

           try (PreparedStatement statement = myConn.prepareStatement("SELECT P.real_name, P.tag, P.nationality FROM players P WHERE birthday LIKE '1990-12%'")) {
               ResultSet rs = statement.executeQuery();
               ResultSetMetaData resultSetMetaData = rs.getMetaData();
               int columnNumber = resultSetMetaData.getColumnCount();
               while (rs.next()) {
                   String realName = rs.getString("real_name");
                   String tag = rs.getString("tag");
                   String nationality = rs.getString("nationality");
                   for(int x = 1; x <= columnNumber; x++){
                       System.out.print(rs.getString(x) + " | ");
                   }
                   System.out.println();
                   //System.out.println(realName + " " + tag + " " + nationality);
               }
           } catch (Exception e) {
               System.out.println(e);
           } finally {
               System.out.println("Query Question One Successful");
           }
       }
